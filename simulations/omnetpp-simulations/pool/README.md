
# Purpose of the simulation

Simulate a p2p network where all nodes broadcast a message every $T$
seconds.

1. Measure the time required to deliver the message to all nodes.
2. Note optimisations required to speed up delivery times.

# P2P Broadcast protocol

We exclude node discover and handshake as we want to measure simply
the delivery times of message in a steady state.

## Failures

Do we handle byzantine failures at this layer. It seems that we can
leave that for the higher layers to address. VSS addresses byzantine
failure of nodes. 

## Attacks

We should address attacks like eclipe attacks that try to isolate a
node. The solution to some attacks will require us to look at
discovery, handshake and peer rotation. So for the moment, we leave
those out too.

# Broadcast Protocol Specification

## Neighbours

Each node has $n$ neighbours with direct TCP connection to each.

## Latency

First pass we fix latency of each channel at 300ms. This can later be
randomised within a range.

## Origin message

1. A node sends an origin message every $Tms$.
2. The size of the message is fixed a $L$ bytes. This should be the
   same as the size of a share generated by a node.
3. [DONE] Origin messages are sent to ALL neighbours.
   
## Handle receieved message

1. Spend $Sms$ processing the message.
2. [TODO] Add received message to a DAG of messages.
   1. [DONE] Use a simple map as the first pass. Map sender -> set of received messages.
3. For any message refefenced in received message that the node
   doesn't have, append a NACK for the message to the $nack_list$.
   1. [TODO] Find any messages referenced in received message that we have received
4. [DONE] Forward the received message to all neighbours with probability $p$.
   1. [DONE] Use hop counts instead. 
   
      
## Sending NACKs

1. Include a copy of the $nack_list$ in the next share.
2. OR Send explicit NACK messages to all neighbours.

## Handle received NACK

# Comparison with LN's onion routing

1. LN uses source routing and hides the path length.
2. LN is used for point to point communication over a P2P network
   1. P2P mining pool needs a broadcast protocol

# Security

1. All miners will know the IP address of all other nodes. We are not
   working on an anonymous broadcast protocol. There's a bunch of
   literature on it [TODO: Add refs] and we can build anonymous
   broadcast if required. Our current goal is to measure how fast we
   can deliver a VSS on a p2p network.
2. 

# Possible Optimisations

1. A node aggregates messages and sends a single message?
