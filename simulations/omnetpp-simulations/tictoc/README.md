
# Purpose of the simulation

Simulate a p2p network where all nodes broadcast a message every $T$
seconds.

1. Measure the time required to deliver the message to all nodes.
2. Note optimisations required to speed up delivery times.

# P2P Broadcast protocol

We exclude node discover and handshake as we want to measure simply
the delivery times of message in a steady state.

## Failures

Do we handle byzantine failures at this layer. It seems that we can
leave that for the higher layers to address. VSS addresses byzantine
failure of nodes. 

## Attacks

We should address attacks like eclipe attacks that try to isolate a
node. The solution to some attacks will require us to look at
discovery, handshake and peer rotation. So for the moment, we leave
those out too.

# Broadcast Protocol Specification

## Neighbours

Each node has $n$ neighbours with direct TCP connection to each.

## Latency

First pass we fix latency of each channel at 300ms. This can later be
randomised within a range.

## Origin message

1. A node sends an origin message every $Tms$.
2. The size of the message is fixed a $L$ bytes. This should be the
   same as the size of a share generated by a node.
3. Origin messages are sent to ALL neighbours.
   
## Handle receieved message

1. Spend $Sms$ processing the message.
2. Add received message to a DAG of messages.
3. For any message refefenced in received message that the node
   doesn't have, append a NACK for the message to the $nack_list$.
4. Forward the received message to all neighbours with probability $p$.
   
## Sending NACKs

1. Include a copy of the $nack_list$ in the next share.
2. OR Send explicit NACK messages to all neighbours.

## Handle received NACK

# Possible Optimisations

1. A node aggregates messages and sends a single message?
